<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SusuPay - Super Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            min-height: 100vh;
            color: #333;
        }

        .super-admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .super-header {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .super-header h1 {
            color: #2d1b69;
            font-size: 2.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .super-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #2d1b69;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .super-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-item {
            background: none;
            border: none;
            color: #2d1b69;
            cursor: pointer;
            font-weight: 600;
            padding: 12px 18px;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .nav-item:hover, .nav-item.active {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 27, 105, 0.3);
        }

        .logout-btn {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #c53030 0%, #a82828 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(197, 48, 48, 0.4);
        }

        .mega-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .mega-stat-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .mega-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .mega-stat-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .mega-stat-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .mega-stat-icon.admins { background: linear-gradient(135deg, #2d1b69 0%, #5a4fcf 100%); }
        .mega-stat-icon.platform { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .mega-stat-icon.security { background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); }
        .mega-stat-icon.performance { background: linear-gradient(135deg, #a55eea 0%, #fd79a8 100%); }

        .mega-stat-content {
            flex: 1;
        }

        .mega-stat-content h3 {
            font-size: 2.5rem;
            color: #2d1b69;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .mega-stat-content p {
            color: #11998e;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .mega-stat-trend {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .trend-positive { color: #38a169; }
        .trend-negative { color: #e53e3e; }
        .trend-neutral { color: #718096; }

        .section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f0f8ff;
        }

        .section-title {
            color: #2d1b69;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 27, 105, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }

        .admin-card {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
        }

        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border-color: #11998e;
        }

        .admin-card.restricted::before {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .admin-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .admin-info h4 {
            color: #2d1b69;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .admin-info p {
            color: #11998e;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .admin-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-restricted {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-suspended {
            background: #fef5e7;
            color: #744210;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .permission-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(45, 27, 105, 0.05);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .permission-toggle {
            width: 40px;
            height: 20px;
            background: #e2e8f0;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .permission-toggle.active {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .permission-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .permission-toggle.active::after {
            transform: translateX(20px);
        }

        .activity-timeline {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
        }

        .timeline-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f4f7;
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-content h5 {
            color: #2d1b69;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-content p {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .timeline-meta {
            color: #a0aec0;
            font-size: 0.8rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f7fafc;
            color: #2d1b69;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .alert-success {
            background: #f0fff4;
            color: #22543d;
            border-left-color: #48bb78;
        }

        .alert-error {
            background: #fff5f5;
            color: #742a2a;
            border-left-color: #e53e3e;
        }

        .alert-warning {
            background: #fffbeb;
            color: #744210;
            border-left-color: #f6ad55;
        }

        .alert-info {
            background: #ebf8ff;
            color: #2a4365;
            border-left-color: #4299e1;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #2d1b69;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2d1b69;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #11998e;
            box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .super-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .super-nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .mega-stats {
                grid-template-columns: 1fr;
            }

            .admin-grid {
                grid-template-columns: 1fr;
            }

            .permissions-grid {
                grid-template-columns: 1fr;
            }

            .super-admin-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="super-admin-container">
        <!-- Super Admin Header -->
        <div class="super-header">
            <div>
                <h1>
                    👑 SusuPay Super Admin
                    <span class="super-badge">Ultimate Control</span>
                </h1>
                <p style="color: #11998e; margin-top: 15px; font-size: 1.1rem; font-weight: 500;">
                    Complete platform oversight and administrative management
                </p>
            </div>
            <div class="super-nav">
                <button class="nav-item active" data-section="dashboard">
                    📊 Overview
                </button>
                <button class="nav-item" data-section="admins">
                    👨‍💼 Admin Management
                </button>
                <button class="nav-item" data-section="permissions">
                    🛡️ Permissions
                </button>
                <button class="nav-item" data-section="activity">
                    📈 Activity Monitor
                </button>
                <button class="nav-item" data-section="security">
                    🔐 Security Center
                </button>
                <button class="logout-btn" id="super-logout">
                    🚪 Logout
                </button>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Mega Stats Grid -->
        <div class="mega-stats">
            <div class="mega-stat-card">
                <div class="mega-stat-icon admins">👨‍💼</div>
                <div class="mega-stat-content">
                    <h3 id="total-admins">0</h3>
                    <p>Active Administrators</p>
                    <div class="mega-stat-trend trend-positive" id="admins-trend">+0 this month</div>
                </div>
            </div>
            <div class="mega-stat-card">
                <div class="mega-stat-icon platform">🏦</div>
                <div class="mega-stat-content">
                    <h3 id="platform-health">98%</h3>
                    <p>Platform Health Score</p>
                    <div class="mega-stat-trend trend-positive" id="health-trend">All systems operational</div>
                </div>
            </div>
            <div class="mega-stat-card">
                <div class="mega-stat-icon security">🛡️</div>
                <div class="mega-stat-content">
                    <h3 id="security-alerts">0</h3>
                    <p>Active Security Alerts</p>
                    <div class="mega-stat-trend trend-neutral" id="security-trend">No threats detected</div>
                </div>
            </div>
            <div class="mega-stat-card">
                <div class="mega-stat-icon performance">⚡</div>
                <div class="mega-stat-content">
                    <h3 id="avg-response">1.2s</h3>
                    <p>Average Response Time</p>
                    <div class="mega-stat-trend trend-positive" id="performance-trend">-200ms improvement</div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="section" id="dashboard-section">
            <div class="section-header">
                <h2 class="section-title">
                    📊 Super Admin Overview
                </h2>
                <button class="btn" onclick="refreshDashboard()">
                    🔄 Refresh All Data
                </button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px;">
                    <h4 style="margin-bottom: 15px; font-size: 1.3rem;">📋 Recent Admin Actions</h4>
                    <div id="recent-admin-actions">
                        <p style="opacity: 0.9;">Loading recent activities...</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 25px; border-radius: 15px;">
                    <h4 style="margin-bottom: 15px; font-size: 1.3rem;">🚨 System Alerts</h4>
                    <div id="system-alerts">
                        <p style="opacity: 0.9;">✅ All systems operational</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #a55eea 0%, #fd79a8 100%); color: white; padding: 25px; border-radius: 15px;">
                    <h4 style="margin-bottom: 15px; font-size: 1.3rem;">📊 Performance Metrics</h4>
                    <div id="performance-metrics">
                        <p style="opacity: 0.9;">🟢 Server Load: 45%</p>
                        <p style="opacity: 0.9;">🟢 Database: Healthy</p>
                        <p style="opacity: 0.9;">🟢 API Response: Fast</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Management Section -->
        <div class="section" id="admins-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    👨‍💼 Administrator Management
                </h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="openAddAdminModal()">
                        ➕ Add Admin
                    </button>
                    <button class="btn btn-info" onclick="exportAdminReport()">
                        📥 Export Report
                    </button>
                </div>
            </div>

            <div class="loading" id="admins-loading">
                <div class="spinner"></div>
                <p>Loading administrators...</p>
            </div>

            <div class="admin-grid" id="admin-grid">
                <!-- Admin cards will be populated here -->
            </div>
        </div>

        <!-- Permissions Section -->
        <div class="section" id="permissions-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    🛡️ Permission Management
                </h2>
                <button class="btn" onclick="createPermissionTemplate()">
                    📋 Create Template
                </button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px;">
                <div style="background: #f8fafc; padding: 25px; border-radius: 15px; border: 2px solid #e2e8f0;">
                    <h4 style="color: #2d1b69; margin-bottom: 20px; font-size: 1.2rem;">🔑 Global Permissions</h4>
                    <div class="permissions-grid">
                        <div class="permission-item">
                            <span>User Management</span>
                            <div class="permission-toggle active" data-permission="user_management"></div>
                        </div>
                        <div class="permission-item">
                            <span>KYC Approval</span>
                            <div class="permission-toggle active" data-permission="kyc_approval"></div>
                        </div>
                        <div class="permission-item">
                            <span>Transaction Approval</span>
                            <div class="permission-toggle active" data-permission="transaction_approval"></div>
                        </div>
                        <div class="permission-item">
                            <span>Financial Reports</span>
                            <div class="permission-toggle active" data-permission="financial_reports"></div>
                        </div>
                        <div class="permission-item">
                            <span>System Settings</span>
                            <div class="permission-toggle" data-permission="system_settings"></div>
                        </div>
                        <div class="permission-item">
                            <span>Admin Creation</span>
                            <div class="permission-toggle" data-permission="admin_creation"></div>
                        </div>
                    </div>
                </div>

                <div style="background: #f8fafc; padding: 25px; border-radius: 15px; border: 2px solid #e2e8f0;">
                    <h4 style="color: #2d1b69; margin-bottom: 20px; font-size: 1.2rem;">⚠️ Restricted Actions</h4>
                    <div id="restricted-actions-list">
                        <p style="color: #718096; font-style: italic;">No restricted actions configured</p>
                    </div>
                    <button class="btn btn-warning btn-small" onclick="configureRestrictions()" style="margin-top: 15px;">
                        ⚙️ Configure Restrictions
                    </button>
                </div>
            </div>
        </div>

        <!-- Activity Monitor Section -->
        <div class="section" id="activity-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    📈 Administrator Activity Monitor
                </h2>
                <div style="display: flex; gap: 10px;">
                    <select style="padding: 10px; border-radius: 8px; border: 2px solid #e2e8f0;" id="activity-filter">
                        <option value="all">All Activities</option>
                        <option value="login">Login Events</option>
                        <option value="approval">Approvals</option>
                        <option value="rejection">Rejections</option>
                        <option value="system">System Changes</option>
                    </select>
                   
                    <button class="btn btn-info" onclick="exportActivityLog()">
                        📊 Export Log
                    </button>
                </div>
            </div>

            <div class="activity-timeline" id="activity-timeline">
                <!-- Activity timeline will be populated here -->
            </div>
        </div>

        <!-- Security Center Section -->
        <div class="section" id="security-section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    🔐 Security Center
                </h2>
                <button class="btn btn-danger" onclick="triggerSecurityScan()">
                    🛡️ Security Scan
                </button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
                <div style="background: #fff5f5; padding: 25px; border-radius: 15px; border: 2px solid #fed7d7;">
                    <h4 style="color: #742a2a; margin-bottom: 20px; font-size: 1.2rem;">🚨 Security Alerts</h4>
                    <div id="security-alerts-detailed">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="color: #38a169; font-size: 1.2rem;">✅</span>
                            <span>No suspicious login attempts</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="color: #38a169; font-size: 1.2rem;">✅</span>
                            <span>All admin accounts secure</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="color: #38a169; font-size: 1.2rem;">✅</span>
                            <span>Database connections encrypted</span>
                        </div>
                    </div>
                </div>

                <div style="background: #f0fff4; padding: 25px; border-radius: 15px; border: 2px solid #c6f6d5;">
                    <h4 style="color: #22543d; margin-bottom: 20px; font-size: 1.2rem;">📊 Access Logs</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table" style="font-size: 0.9rem;">
                            <thead>
                                <tr style="background: #e6fffa;">
                                    <th style="padding: 10px; color: #22543d;">Admin</th>
                                    <th style="padding: 10px; color: #22543d;">Last Login</th>
                                    <th style="padding: 10px; color: #22543d;">IP Address</th>
                                </tr>
                            </thead>
                            <tbody id="access-logs-table">
                                <!-- Access logs will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="background: #fffbeb; padding: 25px; border-radius: 15px; border: 2px solid #fef5e7;">
                    <h4 style="color: #744210; margin-bottom: 20px; font-size: 1.2rem;">⚙️ Security Settings</h4>
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span>Two-Factor Authentication</span>
                            <div class="permission-toggle active" data-setting="2fa"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span>Session Timeout (30 min)</span>
                            <div class="permission-toggle active" data-setting="session_timeout"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span>IP Whitelist</span>
                            <div class="permission-toggle" data-setting="ip_whitelist"></div>
                        </div>
                        <button class="btn btn-warning btn-small" onclick="configureSecuritySettings()">
                            🔧 Advanced Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Admin Modal -->
    <div class="modal" id="add-admin-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAddAdminModal()">&times;</button>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #2d1b69; font-size: 1.8rem; font-weight: 700; margin-bottom: 10px;">
                    ➕ Add New Administrator
                </h2>
                <p style="color: #11998e;">Create a new admin account with customized permissions</p>
            </div>

            <form id="add-admin-form">
                <div class="form-group">
                    <label for="admin-email">Admin Email Address</label>
                    <input type="email" id="admin-email" required placeholder="admin@example.com">
                </div>

                <div class="form-group">
                    <label for="admin-name">Full Name</label>
                    <input type="text" id="admin-name" required placeholder="John Doe">
                </div>

                <div class="form-group">
                    <label for="admin-role">Admin Role</label>
                    <select id="admin-role" required>
                        <option value="">Select Role</option>
                        <option value="admin">Standard Admin</option>
                        <option value="senior_admin">Senior Admin</option>
                        <option value="financial_admin">Financial Admin</option>
                        <option value="security_admin">Security Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Initial Permissions</label>
                    <div class="permissions-grid">
                        <div class="permission-item">
                            <span>User Management</span>
                            <div class="permission-toggle active" data-new-permission="user_management"></div>
                        </div>
                        <div class="permission-item">
                            <span>KYC Approval</span>
                            <div class="permission-toggle active" data-new-permission="kyc_approval"></div>
                        </div>
                        <div class="permission-item">
                            <span>Transaction Approval</span>
                            <div class="permission-toggle active" data-new-permission="transaction_approval"></div>
                        </div>
                        <div class="permission-item">
                            <span>Financial Reports</span>
                            <div class="permission-toggle" data-new-permission="financial_reports"></div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-success">
                        ✅ Create Admin
                    </button>
                    <button type="button" class="btn" onclick="closeAddAdminModal()">
                        ❌ Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Details Modal -->
    <div class="modal" id="admin-details-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAdminDetailsModal()">&times;</button>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <div id="admin-detail-avatar" class="admin-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 15px;"></div>
                <h2 style="color: #2d1b69; font-size: 1.8rem; font-weight: 700; margin-bottom: 5px;" id="admin-detail-name">Admin Name</h2>
                <p style="color: #11998e;" id="admin-detail-email">admin@example.com</p>
                <span id="admin-detail-status" class="admin-status" style="position: static; margin: 10px auto; display: inline-block;"></span>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2d1b69;">Role</label>
                    <p id="admin-detail-role" style="color: #11998e;">-</p>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2d1b69;">Last Login</label>
                    <p id="admin-detail-login" style="color: #11998e;">-</p>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2d1b69;">Actions Today</label>
                    <p id="admin-detail-actions" style="color: #11998e;">-</p>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #2d1b69;">Created</label>
                    <p id="admin-detail-created" style="color: #11998e;">-</p>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h4 style="color: #2d1b69; margin-bottom: 15px;">Current Permissions</h4>
                <div class="permissions-grid" id="admin-detail-permissions">
                    <!-- Permissions will be populated here -->
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-info" onclick="editAdminPermissions()">
                    🔧 Edit Permissions
                </button>
                <button class="btn btn-warning" onclick="suspendAdmin()">
                    ⏸️ Suspend
                </button>
                <button class="btn btn-danger" onclick="deleteAdmin()">
                    🗑️ Remove Admin
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK and JavaScript -->
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, setDoc, updateDoc, deleteDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAoomGKHjU2iUJjjMxEDGCsLzRtIkHtqhY",
            authDomain: "susupay-5286e.firebaseapp.com",
            projectId: "susupay-5286e",
            storageBucket: "susupay-5286e.firebasestorage.app",
            messagingSenderId: "83852132974",
            appId: "1:83852132974:web:2d8be2d1adb7e7639f5c7f",
            measurementId: "G-EQM64CTX83"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // Global variables
        let allAdmins = [];
        let allUsers = [];
        let currentUser = null;
        let selectedAdmin = null;

        // Super Admin email (Only this email has super admin access)
        const superAdminEmail = 'fullword17@gmail.com';

        // Default admin permissions structure
        const defaultPermissions = {
            user_management: true,
            kyc_approval: true,
            transaction_approval: true,
            financial_reports: false,
            system_settings: false,
            admin_creation: false
        };

        // Check if user is super admin
        function isSuperAdmin(email) {
            return email === superAdminEmail;
        }

        // Show alert messages
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Show loading state
        function showLoading(sectionId) {
            const loading = document.getElementById(`${sectionId}-loading`);
            if (loading) loading.style.display = 'block';
        }

        function hideLoading(sectionId) {
            const loading = document.getElementById(`${sectionId}-loading`);
            if (loading) loading.style.display = 'none';
        }

        // Navigation handling
        function initializeNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const section = e.target.dataset.section;
                    switchSection(section);
                });
            });

            // Permission toggle handling
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('permission-toggle')) {
                    e.target.classList.toggle('active');
                }
            });
        }

        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Show corresponding section
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(`${sectionName}-section`).style.display = 'block';

            // Load section data
            loadSectionData(sectionName);
        }

        // Load section-specific data
        async function loadSectionData(sectionName) {
            switch (sectionName) {
                case 'dashboard':
                    await loadDashboardData();
                    break;
                case 'admins':
                    await loadAdmins();
                    break;
                case 'permissions':
                    await loadPermissions();
                    break;
                case 'activity':
                    await loadActivity();
                    break;
                case 'security':
                    await loadSecurity();
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load basic platform stats
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const adminsSnapshot = await getDocs(collection(db, 'admins'));
                
                allUsers = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allAdmins = adminsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Update mega stats
                document.getElementById('total-admins').textContent = allAdmins.length;
                
                // Calculate platform health
                const activeAdmins = allAdmins.filter(admin => admin.status === 'active').length;
                const healthScore = Math.round((activeAdmins / Math.max(allAdmins.length, 1)) * 100);
                document.getElementById('platform-health').textContent = `${healthScore}%`;

                // Load recent admin actions
                loadRecentAdminActions();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showAlert('Failed to load dashboard data', 'error');
            }
        }

        // Load recent admin actions
        function loadRecentAdminActions() {
            const recentActions = [
                { admin: 'admin@susupay.com', action: 'Approved KYC for John Doe', time: '2 minutes ago' },
                { admin: 'admin@susupay.com', action: 'Processed withdrawal of ₵500', time: '15 minutes ago' },
                { admin: 'support@susupay.com', action: 'Rejected contribution request', time: '1 hour ago' }
            ];

            const container = document.getElementById('recent-admin-actions');
            container.innerHTML = recentActions.map(action => `
                <div style="margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.2);">
                    <div style="font-weight: 600;">${action.admin}</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">${action.action}</div>
                    <div style="font-size: 0.8rem; opacity: 0.6;">${action.time}</div>
                </div>
            `).join('');
        }

        // Load admins
        async function loadAdmins() {
            try {
                showLoading('admins');

                const adminsSnapshot = await getDocs(collection(db, 'admins'));
                allAdmins = adminsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                displayAdmins();
                hideLoading('admins');
            } catch (error) {
                console.error('Error loading admins:', error);
                showAlert('Failed to load administrators', 'error');
                hideLoading('admins');
            }
        }

        // Display admins
        function displayAdmins() {
            const adminGrid = document.getElementById('admin-grid');

            if (allAdmins.length === 0) {
                adminGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👨‍💼</div>
                        <p>No administrators found</p>
                        <button class="btn btn-success" onclick="openAddAdminModal()" style="margin-top: 20px;">
                            ➕ Add First Admin
                        </button>
                    </div>
                `;
            } else {
                adminGrid.innerHTML = allAdmins.map(admin => `
                    <div class="admin-card ${admin.status === 'restricted' ? 'restricted' : ''}" onclick="viewAdminDetails('${admin.id}')">
                        <div class="admin-status status-${admin.status || 'active'}">${getStatusText(admin.status)}</div>
                        
                        <div class="admin-header">
                            <div class="admin-avatar">
                                ${(admin.name || admin.email || 'A')[0].toUpperCase()}
                            </div>
                            <div class="admin-info">
                                <h4>${admin.name || 'Admin User'}</h4>
                                <p>${admin.email}</p>
                                <p><strong>Role:</strong> ${admin.role || 'Standard Admin'}</p>
                            </div>
                        </div>

                        <div class="permissions-grid">
                            <div class="permission-item">
                                <span>User Management</span>
                                <div class="permission-toggle ${admin.permissions?.user_management ? 'active' : ''}"></div>
                            </div>
                            <div class="permission-item">
                                <span>KYC Approval</span>
                                <div class="permission-toggle ${admin.permissions?.kyc_approval ? 'active' : ''}"></div>
                            </div>
                            <div class="permission-item">
                                <span>Transactions</span>
                                <div class="permission-toggle ${admin.permissions?.transaction_approval ? 'active' : ''}"></div>
                            </div>
                            <div class="permission-item">
                                <span>Reports</span>
                                <div class="permission-toggle ${admin.permissions?.financial_reports ? 'active' : ''}"></div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn-info btn-small" onclick="editAdmin('${admin.id}'); event.stopPropagation();">
                                🔧 Edit
                            </button>
                            <button class="btn ${admin.status === 'active' ? 'btn-warning' : 'btn-success'} btn-small" onclick="toggleAdminStatus('${admin.id}'); event.stopPropagation();">
                                ${admin.status === 'active' ? '⏸️ Suspend' : '▶️ Activate'}
                            </button>
                        </div>

                        <div style="margin-top: 15px; font-size: 0.8rem; color: #718096; text-align: center;">
                            Last login: ${admin.lastLogin ? new Date(admin.lastLogin.seconds * 1000).toLocaleDateString() : 'Never'}
                        </div>
                    </div>
                `).join('');
            }
        }

        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'active': 'Active',
                'restricted': 'Restricted',
                'suspended': 'Suspended'
            };
            return statusMap[status] || 'Active';
        }

        // Load permissions
        async function loadPermissions() {
            showAlert('Permission management interface loaded', 'success');
        }

        // Load activity
        async function loadActivity() {
            const timeline = document.getElementById('activity-timeline');
            
            // Mock activity data - in production, this would come from Firebase
            const activities = [
                {
                    admin: 'admin@susupay.com',
                    action: 'Approved KYC verification',
                    details: 'Approved KYC for user John Doe',
                    timestamp: new Date(Date.now() - 1000 * 60 * 5), // 5 minutes ago
                    type: 'approval',
                    icon: '✅'
                },
                {
                    admin: 'admin@susupay.com',
                    action: 'Processed withdrawal',
                    details: 'Approved withdrawal of ₵500 for user Jane Smith',
                    timestamp: new Date(Date.now() - 1000 * 60 * 30), // 30 minutes ago
                    type: 'approval',
                    icon: '💰'
                },
                {
                    admin: 'support@susupay.com',
                    action: 'Rejected transaction',
                    details: 'Rejected contribution request - insufficient documentation',
                    timestamp: new Date(Date.now() - 1000 * 60 * 60), // 1 hour ago
                    type: 'rejection',
                    icon: '❌'
                },
                {
                    admin: 'admin@susupay.com',
                    action: 'System login',
                    details: 'Logged into admin panel from IP 192.168.1.100',
                    timestamp: new Date(Date.now() - 1000 * 60 * 120), // 2 hours ago
                    type: 'login',
                    icon: '🔐'
                }
            ];

            timeline.innerHTML = activities.map(activity => `
                <div class="timeline-item">
                    <div class="timeline-icon" style="background: ${getActivityColor(activity.type)};">
                        ${activity.icon}
                    </div>
                    <div class="timeline-content">
                        <h5>${activity.action}</h5>
                        <p>${activity.details}</p>
                        <div class="timeline-meta">
                            By ${activity.admin} • ${activity.timestamp.toLocaleString()}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getActivityColor(type) {
            const colors = {
                'approval': '#48bb78',
                'rejection': '#e53e3e',
                'login': '#4299e1',
                'system': '#a55eea'
            };
            return colors[type] || '#718096';
        }

        // Load security
        async function loadSecurity() {
            const accessLogs = document.getElementById('access-logs-table');
            
            // Mock access logs - in production, this would come from Firebase
            const logs = [
                { admin: 'admin@susupay.com', lastLogin: '2025-01-15 14:30', ip: '192.168.1.100' },
                { admin: 'support@susupay.com', lastLogin: '2025-01-15 09:15', ip: '192.168.1.101' },
                { admin: 'fullword17@gmail.com', lastLogin: '2025-01-15 16:45', ip: '192.168.1.1' }
            ];

            accessLogs.innerHTML = logs.map(log => `
                <tr>
                    <td style="padding: 10px;">${log.admin}</td>
                    <td style="padding: 10px;">${log.lastLogin}</td>
                    <td style="padding: 10px;">${log.ip}</td>
                </tr>
            `).join('');
        }

        // Modal functions
        window.openAddAdminModal = function() {
            document.getElementById('add-admin-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        };

        window.closeAddAdminModal = function() {
            document.getElementById('add-admin-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('add-admin-form').reset();
            
            // Reset permission toggles
            document.querySelectorAll('[data-new-permission]').forEach(toggle => {
                toggle.classList.remove('active');
            });
            // Set default permissions
            document.querySelectorAll('[data-new-permission="user_management"], [data-new-permission="kyc_approval"], [data-new-permission="transaction_approval"]').forEach(toggle => {
                toggle.classList.add('active');
            });
        };

        window.viewAdminDetails = function(adminId) {
            const admin = allAdmins.find(a => a.id === adminId);
            if (!admin) return;

            selectedAdmin = admin;

            // Populate modal
            document.getElementById('admin-detail-avatar').textContent = (admin.name || admin.email || 'A')[0].toUpperCase();
            document.getElementById('admin-detail-name').textContent = admin.name || 'Admin User';
            document.getElementById('admin-detail-email').textContent = admin.email;
            document.getElementById('admin-detail-role').textContent = admin.role || 'Standard Admin';
            document.getElementById('admin-detail-login').textContent = admin.lastLogin ? 
                new Date(admin.lastLogin.seconds * 1000).toLocaleString() : 'Never';
            document.getElementById('admin-detail-actions').textContent = admin.actionsToday || '0';
            document.getElementById('admin-detail-created').textContent = admin.createdAt ? 
                new Date(admin.createdAt.seconds * 1000).toLocaleDateString() : 'Unknown';

            // Update status
            const statusBadge = document.getElementById('admin-detail-status');
            statusBadge.textContent = getStatusText(admin.status);
            statusBadge.className = `admin-status status-${admin.status || 'active'}`;

            // Update permissions
            const permissionsContainer = document.getElementById('admin-detail-permissions');
            const permissions = admin.permissions || defaultPermissions;
            permissionsContainer.innerHTML = Object.entries(permissions).map(([key, value]) => `
                <div class="permission-item">
                    <span>${key.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                    <div class="permission-toggle ${value ? 'active' : ''}" data-admin-permission="${key}"></div>
                </div>
            `).join('');

            // Add event listeners to permission toggles
            permissionsContainer.querySelectorAll('.permission-toggle').forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    const permission = e.target.dataset.adminPermission;
                    updateAdminPermission(adminId, permission, !e.target.classList.contains('active'));
                });
            });

            document.getElementById('admin-details-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        };

        window.closeAdminDetailsModal = function() {
            document.getElementById('admin-details-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            selectedAdmin = null;
        };

        // Admin management functions
        window.toggleAdminStatus = async function(adminId) {
            try {
                const admin = allAdmins.find(a => a.id === adminId);
                if (!admin) return;

                const newStatus = admin.status === 'active' ? 'suspended' : 'active';
                
                const adminRef = doc(db, 'admins', adminId);
                await updateDoc(adminRef, {
                    status: newStatus,
                    updatedAt: new Date()
                });

                // Update local data
                const adminIndex = allAdmins.findIndex(a => a.id === adminId);
                if (adminIndex !== -1) {
                    allAdmins[adminIndex].status = newStatus;
                }

                showAlert(`Admin ${newStatus === 'active' ? 'activated' : 'suspended'} successfully`, 'success');
                displayAdmins();
            } catch (error) {
                console.error('Error updating admin status:', error);
                showAlert('Failed to update admin status', 'error');
            }
        };

        window.updateAdminPermission = async function(adminId, permission, value) {
            try {
                const adminRef = doc(db, 'admins', adminId);
                await updateDoc(adminRef, {
                    [`permissions.${permission}`]: value,
                    updatedAt: new Date()
                });

                // Update local data
                if (adminIndex !== -1) {
                    if (!allAdmins[adminIndex].permissions) {
                        allAdmins[adminIndex].permissions = {};
                    }
                    allAdmins[adminIndex].permissions[permission] = value;
                }

                showAlert('Permission updated successfully', 'success');
                
                // Update the toggle
                const toggle = document.querySelector(`[data-admin-permission="${permission}"]`);
                if (toggle) {
                    toggle.classList.toggle('active', value);
                }
            } catch (error) {
                console.error('Error updating permission:', error);
                showAlert('Failed to update permission', 'error');
            }
        };

        // Handle add admin form
        document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('admin-email').value.trim();
            const name = document.getElementById('admin-name').value.trim();
            const role = document.getElementById('admin-role').value;

            if (!email || !name || !role) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }

            // Check if admin already exists
            const existingAdmin = allAdmins.find(admin => admin.email === email);
            if (existingAdmin) {
                showAlert('An admin with this email already exists', 'error');
                return;
            }

            try {
                // Collect selected permissions
                const permissions = {};
                document.querySelectorAll('[data-new-permission]').forEach(toggle => {
                    const permission = toggle.dataset.newPermission;
                    permissions[permission] = toggle.classList.contains('active');
                });

                // Create new admin document
                const newAdminRef = doc(collection(db, 'admins'));
                await setDoc(newAdminRef, {
                    email: email,
                    name: name,
                    role: role,
                    status: 'active',
                    permissions: permissions,
                    createdAt: new Date(),
                    createdBy: currentUser.email,
                    lastLogin: null,
                    actionsToday: 0
                });

                // Add to local array
                allAdmins.push({
                    id: newAdminRef.id,
                    email,
                    name,
                    role,
                    status: 'active',
                    permissions,
                    createdAt: { seconds: Date.now() / 1000 },
                    createdBy: currentUser.email,
                    lastLogin: null,
                    actionsToday: 0
                });

                showAlert('Administrator added successfully', 'success');
                closeAddAdminModal();
                displayAdmins();
                loadDashboardData(); // Refresh stats
            } catch (error) {
                console.error('Error adding admin:', error);
                showAlert('Failed to add administrator', 'error');
            }
        });

        // Global utility functions
        window.refreshDashboard = function() {
            loadDashboardData();
            showAlert('Dashboard data refreshed', 'success');
        };

        window.exportAdminReport = function() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Name,Email,Role,Status,Last Login,Created Date,Permissions\n" +
                allAdmins.map(admin => [
                    `"${admin.name || 'Unknown'}"`,
                    admin.email,
                    admin.role || 'Standard Admin',
                    admin.status || 'active',
                    admin.lastLogin ? new Date(admin.lastLogin.seconds * 1000).toLocaleDateString() : 'Never',
                    admin.createdAt ? new Date(admin.createdAt.seconds * 1000).toLocaleDateString() : 'Unknown',
                    `"${Object.entries(admin.permissions || {}).filter(([,v]) => v).map(([k,]) => k).join(', ')}"`
                ].join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "susupay_admin_report.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Admin report exported successfully', 'success');
        };

        window.exportActivityLog = function() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Timestamp,Admin,Action,Details,Type\n" +
                "2025-01-15 14:35,admin@susupay.com,Approved KYC verification,Approved KYC for user John Doe,approval\n" +
                "2025-01-15 14:05,admin@susupay.com,Processed withdrawal,Approved withdrawal of ₵500 for user Jane Smith,approval\n" +
                "2025-01-15 13:35,support@susupay.com,Rejected transaction,Rejected contribution request - insufficient documentation,rejection";

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "susupay_activity_log.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Activity log exported successfully', 'success');
        };

        window.createPermissionTemplate = function() {
            showAlert('Permission template creation feature coming soon', 'info');
        };

        window.configureRestrictions = function() {
            showAlert('Advanced restriction configuration feature coming soon', 'info');
        };

        window.triggerSecurityScan = function() {
            showAlert('Security scan initiated. Results will be available shortly.', 'info');
            
            // Simulate scan completion
            setTimeout(() => {
                showAlert('Security scan completed. No threats detected.', 'success');
            }, 3000);
        };

        window.configureSecuritySettings = function() {
            showAlert('Advanced security settings configuration feature coming soon', 'info');
        };

        window.editAdmin = function(adminId) {
            viewAdminDetails(adminId);
        };

        window.editAdminPermissions = function() {
            showAlert('Permission editing enabled. Toggle permissions above to make changes.', 'info');
        };

        window.suspendAdmin = function() {
            if (!selectedAdmin) return;
            
            if (confirm(`Are you sure you want to suspend ${selectedAdmin.name || selectedAdmin.email}?`)) {
                toggleAdminStatus(selectedAdmin.id);
                closeAdminDetailsModal();
            }
        };

        window.deleteAdmin = function() {
            if (!selectedAdmin) return;
            
            const confirmation = prompt(`Type "DELETE" to confirm removal of ${selectedAdmin.name || selectedAdmin.email}:`);
            if (confirmation !== 'DELETE') {
                showAlert('Admin removal cancelled', 'info');
                return;
            }
            
            deleteAdminPermanently(selectedAdmin.id);
        };

        async function deleteAdminPermanently(adminId) {
            try {
                await deleteDoc(doc(db, 'admins', adminId));
                
                // Remove from local array
                allAdmins = allAdmins.filter(admin => admin.id !== adminId);
                
                showAlert('Administrator removed successfully', 'success');
                closeAdminDetailsModal();
                displayAdmins();
                loadDashboardData();
            } catch (error) {
                console.error('Error deleting admin:', error);
                showAlert('Failed to remove administrator', 'error');
            }
        }

        // Initialize super admin login check
        function checkSuperAdminAccess() {
            onAuthStateChanged(auth, (user) => {
                if (user && isSuperAdmin(user.email)) {
                    currentUser = user;
                    initializeSuperAdminDashboard();
                } else {
                    showSuperAdminLogin();
                }
            });
        }

        function showSuperAdminLogin() {
            document.body.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.98); border-radius: 25px; padding: 50px; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3); backdrop-filter: blur(15px); width: 100%; max-width: 450px; text-align: center; border: 2px solid rgba(255, 215, 0, 0.3);">
                        <h1 style="color: #2d1b69; font-size: 2.2rem; font-weight: 800; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">
                            👑 SusuPay Super Admin
                        </h1>
                        <div style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #2d1b69; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 30px; display: inline-block;">
                            Ultimate Control Access
                        </div>
                        
                        <div id="super-admin-alert-container"></div>
                        
                        <form id="super-admin-login-form">
                            <div style="margin-bottom: 25px; text-align: left;">
                                <label style="display: block; margin-bottom: 8px; color: #2d1b69; font-weight: 700;">Super Admin Email</label>
                                <input type="email" id="super-admin-email" required style="width: 100%; padding: 15px; border: 3px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: all 0.3s ease;">
                            </div>
                            <div style="margin-bottom: 25px; text-align: left;">
                                <label style="display: block; margin-bottom: 8px; color: #2d1b69; font-weight: 700;">Super Admin Password</label>
                                <input type="password" id="super-admin-password" required style="width: 100%; padding: 15px; border: 3px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: all 0.3s ease;">
                            </div>
                            <button type="submit" style="background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%); color: white; border: none; padding: 16px 30px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: 700; width: 100%; transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(45, 27, 105, 0.3);">
                                👑 Super Admin Access
                            </button>
                        </form>
                        
                        <div style="margin-top: 30px; padding: 20px; background: #fff5f5; border-radius: 10px; border: 2px solid #fed7d7;">
                            <div style="color: #742a2a; font-weight: 600; margin-bottom: 5px;">⚠️ Restricted Access</div>
                            <div style="color: #a0616a; font-size: 0.9rem;">
                                Only authorized super administrators can access this panel. All login attempts are monitored and logged.
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Style the inputs for focus effects
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', (e) => {
                    e.target.style.borderColor = '#11998e';
                    e.target.style.boxShadow = '0 0 0 3px rgba(17, 153, 142, 0.1)';
                });
                input.addEventListener('blur', (e) => {
                    e.target.style.borderColor = '#e2e8f0';
                    e.target.style.boxShadow = 'none';
                });
            });

            document.getElementById('super-admin-login-form').addEventListener('submit', handleSuperAdminLogin);
        }

        async function handleSuperAdminLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('super-admin-email').value.trim();
            const password = document.getElementById('super-admin-password').value;

            if (!isSuperAdmin(email)) {
                const alertContainer = document.getElementById('super-admin-alert-container');
                alertContainer.innerHTML = `
                    <div style="padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 600; background: #fff5f5; color: #742a2a; border: 2px solid #feb2b2; border-left: 4px solid #e53e3e;">
                        🚫 Access Denied: Super Admin credentials required
                    </div>
                `;
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                const alertContainer = document.getElementById('super-admin-alert-container');
                let errorMessage = 'Invalid super admin credentials';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Super admin account not found';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Invalid super admin password';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format';
                        break;
                }
                
                alertContainer.innerHTML = `
                    <div style="padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: 600; background: #fff5f5; color: #742a2a; border: 2px solid #feb2b2; border-left: 4px solid #e53e3e;">
                        ❌ ${errorMessage}
                    </div>
                `;
            }
        }

        async function initializeSuperAdminDashboard() {
            try {
                // Initialize navigation
                initializeNavigation();
                
                // Load initial data
                await loadDashboardData();
                
                // Setup logout
                document.getElementById('super-logout').addEventListener('click', async () => {
                    if (confirm('Are you sure you want to logout from Super Admin dashboard?')) {
                        try {
                            await signOut(auth);
                            location.reload();
                        } catch (error) {
                            console.error('Logout error:', error);
                        }
                    }
                });

                // Setup activity filter
                document.getElementById('activity-filter')?.addEventListener('change', loadActivity);

                // Show welcome message
                showAlert(`Welcome back, Super Admin! You have ultimate control over the SusuPay platform.`, 'success');
                
            } catch (error) {
                console.error('Error initializing super admin dashboard:', error);
                showAlert('Failed to initialize dashboard', 'error');
            }
        }

        // Initialize the super admin dashboard
        checkSuperAdminAccess();
    </script>
</body>
